# OldenFyre Inventory API Documentation

This document provides comprehensive information about all available API endpoints for the OldenFyre Inventory system.

## Table of Contents

1. [Overview](#overview)
2. [Base URL](#base-url)
3. [Authentication](#authentication)
4. [Rate Limiting](#rate-limiting)
5. [Error Handling](#error-handling)
6. [Data Models](#data-models)
7. [Product Endpoints](#product-endpoints)
8. [Order Endpoints](#order-endpoints)
9. [Dashboard Endpoints](#dashboard-endpoints)
10. [Inventory Management](#inventory-management)
11. [Deployment Information](#deployment-information)

## Overview

The OldenFyre Inventory API is a RESTful API built with Node.js, Express, and MongoDB. It provides endpoints for managing products and orders in an inventory system, with features including:

- Product management with automatic code generation
- Order processing with inventory tracking
- Soft delete functionality for data integrity
- Comprehensive validation and error handling
- Support for both local development and serverless deployment (Vercel)

## Base URL

```
Development: http://localhost:3000/api
Production: https://your-app.vercel.app/api
```

## Authentication

Currently, the API does not implement authentication or authorization. All endpoints are publicly accessible. In a production environment, consider implementing:

- API key authentication
- JWT token-based authentication
- Role-based access control (RBAC)

## Rate Limiting

Currently, the API does not implement rate limiting. In a production environment, consider implementing:

- Request rate limiting per IP address
- API key-based rate limiting
- Tiered access levels

## Error Handling

All endpoints follow a consistent error response format:

### Standard Error Response

```json
{
  "success": false,
  "message": "Error description",
  "error": "Detailed error message (for server errors)",
  "errors": ["Array of validation errors (for validation errors)"]
}
```

### Common HTTP Status Codes

- `200 OK` - Request successful
- `201 Created` - Resource created successfully
- `400 Bad Request` - Validation error or invalid request data
- `404 Not Found` - Resource not found
- `500 Internal Server Error` - Server-side error

## Data Models

### Product Model

```json
{
  "_id": "string",
  "code": "string (4 digits + 1 letter, auto-generated)",
  "name": "string (required)",
  "description": "string (optional)",
  "category": "string (required)",
  "series": "string (optional)",
  "pricing": {
    "buy": "number (required, min: 0)",
    "sell": "number (required, min: 0)",
    "discount": "number (optional, min: 0, max: 100, default: 0)"
  },
  "media": {
    "thumbnail": "string (optional, URL)",
    "images": ["string (optional, array of URLs)"]
  },
  "status": "string (enum: active, inactive, discontinued, sold_out, deleted, default: active)",
  "quantity": "number (required, min: 0, default: 0)",
  "createdAt": "date (auto-generated)",
  "updatedAt": "date (auto-generated)"
}
```

### Order Model

```json
{
  "_id": "string",
  "code": "string (auto-generated, format: YYMMDD-RANDOM)",
  "customer": {
    "name": "string (required)",
    "phone": "string (required)",
    "alt_phone": "string (optional)",
    "address": "string (required)"
  },
  "items": [
    {
      "productCode": "string (required, valid product code)",
      "quantity": "number (required, min: 1)",
      "price": "number (required, min: 0)"
    }
  ],
  "totals": {
    "subtotal": "number (required, min: 0, auto-calculated)",
    "discount": "number (optional, min: 0, default: 0)",
    "final": "number (required, min: 0, auto-calculated)"
  },
  "status": "string (enum: pending, confirmed, shipped, delivered, cancelled, default: pending)",
  "createdAt": "date (auto-generated)",
  "updatedAt": "date (auto-generated)"
}
```

## Product Endpoints

### 1. Create a New Product

Creates a new product in inventory. The product code is automatically generated by the backend.

- **Endpoint:** `POST /products`
- **Headers:** `Content-Type: application/json`
- **Request Body:**

```json
{
  "name": "Product Name",
  "description": "Product description goes here",
  "category": "Electronics",
  "series": "Product Series",
  "pricing": {
    "buy": 100,
    "sell": 150,
    "discount": 10
  },
  "media": {
    "thumbnail": "https://example.com/thumbnail.jpg",
    "images": [
      "https://example.com/image1.jpg",
      "https://example.com/image2.jpg"
    ]
  },
  "status": "active",
  "quantity": 50
}
```

- **Required Fields:**

  - `name`: String - Product name
  - `category`: String - Product category
  - `pricing.buy`: Number - Purchase price (min: 0)
  - `pricing.sell`: Number - Selling price (min: 0)
  - `quantity`: Number - Stock quantity (min: 0)

- **Optional Fields:**

  - `description`: String - Product description
  - `series`: String - Product series
  - `pricing.discount`: Number - Discount percentage (0-100, defaults to 0)
  - `media.thumbnail`: String - Thumbnail image URL
  - `media.images`: Array of strings - Additional image URLs
  - `status`: String - Product status ("active", "inactive", "discontinued", "sold_out", defaults to "active")

- **Validation Rules:**

  - Product code is auto-generated and cannot be manually set
  - All numeric fields must be non-negative
  - Discount must be between 0 and 100
  - Product codes follow format: 4 digits + 1 letter (e.g., "1234A")
  - **Automatic Status Management**: When `pricing.discount` is greater than 0, product status is automatically set to "discontinued"

- **Success Response (201):**

```json
{
  "success": true,
  "message": "Product created successfully",
  "data": {
    "_id": "64a7b8c9f1d2e4a3c8e7d9f0",
    "code": "1234A",
    "name": "Product Name",
    "description": "Product description goes here",
    "category": "Electronics",
    "series": "Product Series",
    "pricing": {
      "buy": 100,
      "sell": 150,
      "discount": 10
    },
    "media": {
      "thumbnail": "https://example.com/thumbnail.jpg",
      "images": [
        "https://example.com/image1.jpg",
        "https://example.com/image2.jpg"
      ]
    },
    "status": "active",
    "quantity": 50,
    "createdAt": "2023-07-05T12:00:00.000Z",
    "updatedAt": "2023-07-05T12:00:00.000Z",
    "__v": 0
  }
}
```

### 2. Get All Products

Retrieves all products from inventory, excluding deleted products.

- **Endpoint:** `GET /products`
- **Query Parameters:** None
- **Success Response (200):**

```json
{
  "success": true,
  "message": "Products retrieved successfully",
  "data": [
    {
      "_id": "64a7b8c9f1d2e4a3c8e7d9f0",
      "code": "1234A",
      "name": "Product Name",
      "description": "Product description goes here",
      "category": "Electronics",
      "series": "Product Series",
      "pricing": {
        "buy": 100,
        "sell": 150,
        "discount": 10
      },
      "media": {
        "thumbnail": "https://example.com/thumbnail.jpg",
        "images": [
          "https://example.com/image1.jpg",
          "https://example.com/image2.jpg"
        ]
      },
      "status": "active",
      "quantity": 50,
      "createdAt": "2023-07-05T12:00:00.000Z",
      "updatedAt": "2023-07-05T12:00:00.000Z",
      "__v": 0
    }
  ]
}
```

### 3. Get Single Product by Code

Retrieves a specific product using its unique code.

- **Endpoint:** `GET /products/:code`
- **URL Parameters:**

  - `code`: String - The unique product code (4 digits + 1 letter)

- **Success Response (200):**

```json
{
  "success": true,
  "message": "Product retrieved successfully",
  "data": {
    "_id": "64a7b8c9f1d2e4a3c8e7d9f0",
    "code": "1234A",
    "name": "Product Name",
    "description": "Product description goes here",
    "category": "Electronics",
    "series": "Product Series",
    "pricing": {
      "buy": 100,
      "sell": 150,
      "discount": 10
    },
    "media": {
      "thumbnail": "https://example.com/thumbnail.jpg",
      "images": [
        "https://example.com/image1.jpg",
        "https://example.com/image2.jpg"
      ]
    },
    "status": "active",
    "quantity": 50,
    "createdAt": "2023-07-05T12:00:00.000Z",
    "updatedAt": "2023-07-05T12:00:00.000Z",
    "__v": 0
  }
}
```

- **Error Response (404):**

```json
{
  "success": false,
  "message": "Product not found"
}
```

### 4. Update Product by Code

Updates an existing product using its unique code. The product code cannot be changed.

- **Endpoint:** `PUT /products/:code`
- **URL Parameters:**
  - `code`: String - The unique product code (4 digits + 1 letter)
- **Headers:** `Content-Type: application/json`
- **Request Body:** Any product fields except `code`

```json
{
  "name": "Updated Product Name",
  "description": "This product has been updated",
  "category": "Electronics",
  "pricing": {
    "buy": 100,
    "sell": 175,
    "discount": 10
  },
  "quantity": 75
}
```

- **Note:** When updating, you need to include all required fields (name, category, pricing.buy, pricing.sell, quantity)

- **Success Response (200):**

```json
{
  "success": true,
  "message": "Product updated successfully",
  "data": {
    "_id": "64a7b8c9f1d2e4a3c8e7d9f0",
    "code": "1234A",
    "name": "Updated Product Name",
    "description": "This product has been updated",
    "category": "Electronics",
    "series": "Product Series",
    "pricing": {
      "buy": 100,
      "sell": 175,
      "discount": 10
    },
    "media": {
      "thumbnail": "https://example.com/thumbnail.jpg",
      "images": [
        "https://example.com/image1.jpg",
        "https://example.com/image2.jpg"
      ]
    },
    "status": "active",
    "quantity": 75,
    "createdAt": "2023-07-05T12:00:00.000Z",
    "updatedAt": "2023-07-05T12:30:00.000Z",
    "__v": 0
  }
}
```

- **Error Response (404):**

```json
{
  "success": false,
  "message": "Product not found"
}
```

- **Validation Error Response (400):**

```json
{
  "success": false,
  "message": "Validation Error",
  "errors": ["Path `pricing.buy` is required."]
}
```

### 5. Delete Product by Code (Soft Delete)

Marks a product as deleted by changing its status to 'deleted'. The product remains in the database for data integrity.

- **Endpoint:** `DELETE /products/:code`
- **URL Parameters:**

  - `code`: String - The unique product code (4 digits + 1 letter)

- **Success Response (200):**

```json
{
  "success": true,
  "message": "Product deleted successfully",
  "data": {
    "_id": "64a7b8c9f1d2e4a3c8e7d9f0",
    "code": "1234A",
    "name": "Product Name",
    "description": "Product description goes here",
    "category": "Electronics",
    "series": "Product Series",
    "pricing": {
      "buy": 100,
      "sell": 150,
      "discount": 10
    },
    "media": {
      "thumbnail": "https://example.com/thumbnail.jpg",
      "images": [
        "https://example.com/image1.jpg",
        "https://example.com/image2.jpg"
      ]
    },
    "status": "deleted",
    "quantity": 50,
    "createdAt": "2023-07-05T12:00:00.000Z",
    "updatedAt": "2023-07-05T12:00:00.000Z",
    "__v": 0
  }
}
```

- **Error Response (404):**

```json
{
  "success": false,
  "message": "Product not found"
}
```

## Order Endpoints

### 1. Create a New Order

Creates a new order in the system with inventory validation and automatic stock reduction.

- **Endpoint:** `POST /orders`
- **Headers:** `Content-Type: application/json`
- **Request Body:**

```json
{
  "customer": {
    "name": "John Doe",
    "phone": "+1234567890",
    "alt_phone": "+0987654321",
    "address": "123 Main St, City, State 12345"
  },
  "items": [
    {
      "productCode": "1234A",
      "quantity": 2,
      "price": 150
    },
    {
      "productCode": "5678B",
      "quantity": 1,
      "price": 75
    }
  ],
  "totals": {
    "discount": 25
  },
  "status": "pending"
}
```

- **Required Fields:**

  - `customer.name`: String - Customer name
  - `customer.phone`: String - Customer phone number
  - `customer.address`: String - Customer address
  - `items`: Array - Order items (must contain at least one item)

- **Optional Fields:**

  - `customer.alt_phone`: String - Alternative phone number
  - `totals.discount`: Number - Discount amount (defaults to 0)
  - `status`: String - Order status ("pending", "confirmed", "shipped", "delivered", "cancelled", defaults to "pending")

- **Items Array Required Fields:**

  - `productCode`: String - Product code (4 digits + 1 letter)
  - `quantity`: Number - Item quantity (minimum 1)
  - `price`: Number - Item price at time of order (minimum 0, optional - will use product's sell price if not provided)

- **Business Logic:**

  - Product codes are validated against existing products
  - Stock availability is checked for each item
  - If price is not provided, the product's sell price is used
  - Subtotal is calculated as sum of (item.price × item.quantity)
  - Final amount is calculated as subtotal - discount
  - Product quantities are automatically reduced upon successful order creation
  - Order code is auto-generated with format: YYMMDD-RANDOM (e.g., "231205-K8SJ2F")

- **Success Response (201):**

```json
{
  "success": true,
  "message": "Order created successfully",
  "data": {
    "_id": "64a7b8c9f1d2e4a3c8e7d9f1",
    "code": "231205-K8SJ2F",
    "customer": {
      "name": "John Doe",
      "phone": "+1234567890",
      "alt_phone": "+0987654321",
      "address": "123 Main St, City, State 12345"
    },
    "items": [
      {
        "productCode": "1234A",
        "quantity": 2,
        "price": 150
      },
      {
        "productCode": "5678B",
        "quantity": 1,
        "price": 75
      }
    ],
    "totals": {
      "subtotal": 375,
      "discount": 25,
      "final": 350
    },
    "status": "pending",
    "createdAt": "2023-07-05T12:00:00.000Z",
    "updatedAt": "2023-07-05T12:00:00.000Z",
    "__v": 0
  }
}
```

- **Error Response (400) - Product Not Found:**

```json
{
  "success": false,
  "message": "Product with code 9999Z not found"
}
```

- **Error Response (400) - Insufficient Stock:**

```json
{
  "success": false,
  "message": "Insufficient stock for product 1234A. Available: 1, Requested: 2"
}
```

### 2. Get All Orders

Retrieves all orders from the system.

- **Endpoint:** `GET /orders`
- **Success Response (200):**

```json
{
  "success": true,
  "message": "Orders retrieved successfully",
  "data": [
    {
      "_id": "64a7b8c9f1d2e4a3c8e7d9f1",
      "code": "231205-K8SJ2F",
      "customer": {
        "name": "John Doe",
        "phone": "+1234567890",
        "alt_phone": "+0987654321",
        "address": "123 Main St, City, State 12345"
      },
      "items": [
        {
          "productCode": "1234A",
          "quantity": 2,
          "price": 150
        },
        {
          "productCode": "5678B",
          "quantity": 1,
          "price": 75
        }
      ],
      "totals": {
        "subtotal": 375,
        "discount": 25,
        "final": 350
      },
      "status": "pending",
      "createdAt": "2023-07-05T12:00:00.000Z",
      "updatedAt": "2023-07-05T12:00:00.000Z",
      "__v": 0
    }
  ]
}
```

### 3. Get Single Order by Code

Retrieves a specific order using its unique code.

- **Endpoint:** `GET /orders/:code`
- **URL Parameters:**

  - `code`: String - The unique order code (format: YYMMDD-RANDOM)

- **Success Response (200):**

```json
{
  "success": true,
  "message": "Order retrieved successfully",
  "data": {
    "_id": "64a7b8c9f1d2e4a3c8e7d9f1",
    "code": "231205-K8SJ2F",
    "customer": {
      "name": "John Doe",
      "phone": "+1234567890",
      "alt_phone": "+0987654321",
      "address": "123 Main St, City, State 12345"
    },
    "items": [
      {
        "productCode": "1234A",
        "quantity": 2,
        "price": 150
      },
      {
        "productCode": "5678B",
        "quantity": 1,
        "price": 75
      }
    ],
    "totals": {
      "subtotal": 375,
      "discount": 25,
      "final": 350
    },
    "status": "pending",
    "createdAt": "2023-07-05T12:00:00.000Z",
    "updatedAt": "2023-07-05T12:00:00.000Z",
    "__v": 0
  }
}
```

- **Error Response (404):**

```json
{
  "success": false,
  "message": "Order not found"
}
```

### 4. Update Order by Code

Updates an existing order using its unique code with inventory management.

- **Endpoint:** `PUT /orders/:code`
- **URL Parameters:**
  - `code`: String - The unique order code
- **Headers:** `Content-Type: application/json`
- **Request Body:** Any order fields except `code`

```json
{
  "customer": {
    "name": "Jane Doe",
    "phone": "+1987654321"
  },
  "items": [
    {
      "productCode": "1234A",
      "quantity": 3,
      "price": 150
    }
  ],
  "totals": {
    "discount": 10
  },
  "status": "confirmed"
}
```

- **Business Logic:**

  - If items are updated, existing inventory is restored first
  - New items are validated for stock availability
  - Inventory is adjusted based on the new item quantities
  - Totals are recalculated automatically
  - Order code cannot be changed

- **Success Response (200):**

```json
{
  "success": true,
  "message": "Order updated successfully",
  "data": {
    "_id": "64a7b8c9f1d2e4a3c8e7d9f1",
    "code": "231205-K8SJ2F",
    "customer": {
      "name": "Jane Doe",
      "phone": "+1987654321",
      "alt_phone": "+0987654321",
      "address": "123 Main St, City, State 12345"
    },
    "items": [
      {
        "productCode": "1234A",
        "quantity": 3,
        "price": 150
      }
    ],
    "totals": {
      "subtotal": 450,
      "discount": 10,
      "final": 440
    },
    "status": "confirmed",
    "createdAt": "2023-07-05T12:00:00.000Z",
    "updatedAt": "2023-07-05T12:30:00.000Z",
    "__v": 0
  }
}
```

- **Error Response (404):**

```json
{
  "success": false,
  "message": "Order not found"
}
```

### 5. Delete Order by Code (Soft Delete)

Marks an order as cancelled by changing its status to 'cancelled' and restores inventory.

- **Endpoint:** `DELETE /orders/:code`
- **URL Parameters:**

  - `code`: String - The unique order code

- **Business Logic:**

  - Order status is changed to 'cancelled'
  - Product quantities are automatically restored to inventory
  - If order is already cancelled, inventory is not restored again

- **Success Response (200):**

```json
{
  "success": true,
  "message": "Order cancelled successfully",
  "data": {
    "_id": "64a7b8c9f1d2e4a3c8e7d9f1",
    "code": "231205-K8SJ2F",
    "customer": {
      "name": "John Doe",
      "phone": "+1234567890",
      "alt_phone": "+0987654321",
      "address": "123 Main St, City, State 12345"
    },
    "items": [
      {
        "productCode": "1234A",
        "quantity": 2,
        "price": 150
      },
      {
        "productCode": "5678B",
        "quantity": 1,
        "price": 75
      }
    ],
    "totals": {
      "subtotal": 375,
      "discount": 25,
      "final": 350
    },
    "status": "cancelled",
    "createdAt": "2023-07-05T12:00:00.000Z",
    "updatedAt": "2023-07-05T12:45:00.000Z",
    "__v": 0
  }
}
```

- **Error Response (404):**

```json
{
  "success": false,
  "message": "Order not found"
}
```

### 6. Update Order Status

Updates only the status of an existing order with inventory management.

- **Endpoint:** `PATCH /orders/:code/status`
- **URL Parameters:**
  - `code`: String - The unique order code
- **Headers:** `Content-Type: application/json`
- **Request Body:**

```json
{
  "status": "shipped"
}
```

- **Valid Status Values:** "pending", "confirmed", "shipped", "delivered", "cancelled"

- **Business Logic:**

  - Changing to 'cancelled' restores inventory
  - Changing from 'cancelled' to any other status deducts inventory again (if stock is available)
  - Other status changes don't affect inventory

- **Success Response (200):**

```json
{
  "success": true,
  "message": "Order status updated successfully",
  "data": {
    "_id": "64a7b8c9f1d2e4a3c8e7d9f1",
    "code": "231205-K8SJ2F",
    "customer": {
      "name": "John Doe",
      "phone": "+1234567890",
      "alt_phone": "+0987654321",
      "address": "123 Main St, City, State 12345"
    },
    "items": [
      {
        "productCode": "1234A",
        "quantity": 2,
        "price": 150
      },
      {
        "productCode": "5678B",
        "quantity": 1,
        "price": 75
      }
    ],
    "totals": {
      "subtotal": 375,
      "discount": 25,
      "final": 350
    },
    "status": "shipped",
    "createdAt": "2023-07-05T12:00:00.000Z",
    "updatedAt": "2023-07-05T13:00:00.000Z",
    "__v": 0
  }
}
```

- **Error Response (400):**

```json
{
  "success": false,
  "message": "Invalid status"
}
```

- **Error Response (404):**

```json
{
  "success": false,
  "message": "Order not found"
}
```

## Dashboard Endpoints

The dashboard endpoints provide comprehensive analytics and insights for the OldenFyre Inventory system.

### 1. Get Dashboard Statistics

Provides comprehensive dashboard statistics including product analytics, order metrics, revenue analysis, top products, and customer insights.

- **Endpoint:** `GET /dashboard/stats`
- **Method:** GET
- **Description:** Retrieves comprehensive dashboard statistics with detailed analytics

**Success Response (200):**

```json
{
  "success": true,
  "message": "Dashboard statistics retrieved successfully",
  "data": {
    "products": {
      "total": 8,
      "active": 5,
      "inactive": 1,
      "discontinued": 5,
      "soldOut": 0,
      "lowStock": 3,
      "outOfStock": 1,
      "totalInventoryValue": 43610,
      "totalCostValue": 30660,
      "totalPotentialRevenue": 43610,
      "averageProductPrice": 174.375,
      "averageProductCost": 117.5,
      "byCategory": [
        {
          "_id": "Electronics",
          "count": 6,
          "totalQuantity": 218,
          "totalValue": 37970
        },
        {
          "_id": "Test Category",
          "count": 2,
          "totalQuantity": 80,
          "totalValue": 12900
        },
        {
          "_id": "Vintage",
          "count": 3,
          "totalQuantity": 6,
          "totalValue": 720
        }
      ]
    },
    "orders": {
      "total": 2,
      "thisMonth": 2,
      "lastMonth": 0,
      "thisYear": 2,
      "last7Days": 2,
      "last30Days": 2,
      "last90Days": 2,
      "byStatus": {
        "confirmed": 1,
        "pending": 1
        // others status here
      },
      "monthlyGrowth": 0
    },
    "revenue": {
      "total": 1750,
      "totalSubtotal": 1800,
      "totalDiscount": 50,
      "averageOrderValue": 875,
      "currentMonth": {
        "revenue": 1750,
        "subtotal": 1800,
        "discount": 50,
        "orderCount": 2,
        "averageOrderValue": 875
      },
      "lastMonth": {
        "revenue": 0,
        "subtotal": 0,
        "discount": 0,
        "orderCount": 0,
        "averageOrderValue": 0
      },
      "yearToDate": {
        "revenue": 1750,
        "orderCount": 2,
        "averageOrderValue": 875
      },
      "monthlyGrowth": 0,
      "revenueByMonth": [
        {
          "_id": 12,
          "revenue": 1750,
          "orderCount": 2,
          "averageOrderValue": 875
        }
      ]
    },
    "topSellingProducts": [
      {
        "_id": "9591B",
        "totalQuantity": 12,
        "totalRevenue": 1800,
        "orderCount": 2,
        "productDetails": {
          "name": "Updated Product Name",
          "category": "Electronics"
        }
      }
    ],
    "customers": {
      "total": 2,
      "topCustomers": [
        {
          "_id": "+1234567890",
          "name": "John Doe",
          "orderCount": 1,
          "totalSpent": 900,
          "averageOrderValue": 900,
          "firstOrderDate": "2025-12-20T21:24:27.329Z",
          "lastOrderDate": "2025-12-20T21:24:27.329Z"
        }
      ]
    }
  }
}
```

**Data Fields Explained:**

- **products**: Comprehensive product analytics

  - `total`: Total number of products (excluding deleted)
  - `active/inactive/discontinued/soldOut`: Count by status
  - `lowStock/outOfStock`: Inventory alerts (low stock < 5, out of stock = 0)
  - `totalInventoryValue`: Sum of (quantity × sell price) for all products
  - `totalCostValue`: Sum of (quantity × buy price) for all products
  - `byCategory`: Products grouped by category with counts and values

- **orders**: Order statistics and trends

  - `total/thisMonth/lastMonth/thisYear`: Order counts for different time periods
  - `last7Days/last30Days/last90Days`: Recent order counts
  - `byStatus`: Orders grouped by status (pending, confirmed, shipped, delivered, cancelled)
  - `monthlyGrowth`: Percentage growth from last month to current month

- **revenue**: Financial analytics and trends

  - `total`: Total revenue from all orders
  - `currentMonth/lastMonth`: Monthly comparisons with detailed breakdown
  - `yearToDate`: Year-to-date revenue and order metrics
  - `revenueByMonth`: Monthly revenue trends for current year
  - `monthlyGrowth`: Revenue growth percentage from last month

- **topSellingProducts**: Best performing products

  - Ranked by total revenue with product details
  - Includes quantity sold and order count

- **customers**: Customer analytics
  - `total`: Total unique customers
  - `topCustomers`: Top customers by total spending with order history

### 2. Get Inventory Alerts

Retrieves various inventory alerts including low stock items, out of stock products, high discount items, and discontinued products.

- **Endpoint:** `GET /dashboard/inventory-alerts`
- **Method:** GET
- **Description:** Retrieves inventory alerts for proactive management

**Success Response (200):**

```json
{
  "success": true,
  "message": "Inventory alerts retrieved successfully",
  "data": {
    "lowStock": {
      "count": 12,
      "products": [
        {
          "code": "1234A",
          "name": "Product Name",
          "quantity": 5,
          "status": "active",
          "category": "Category Name"
        }
      ]
    },
    "outOfStock": {
      "count": 3,
      "products": [...]
    },
    "highDiscount": {
      "count": 5,
      "products": [...]
    },
    "discontinued": {
      "count": 2,
      "products": [...]
    },
    "soldOut": {
      "count": 1,
      "products": [...]
    }
  }
}
```

**Alert Types Explained:**

- **lowStock**: Products with quantity less than 10
- **outOfStock**: Products with quantity equal to 0
- **highDiscount**: Products with discount greater than 50%
- **discontinued**: Products with status "discontinued"
- **soldOut**: Products with status "sold_out"

### 3. Get Recent Orders

Retrieves the most recent orders with optional limit parameter.

- **Endpoint:** `GET /dashboard/recent-orders?limit=${limit}`
- **Method:** GET
- **Description:** Retrieves recent orders sorted by creation date (newest first)

**Query Parameters:**

- `limit` (optional): Number of orders to retrieve (1-100, default: 10)

**Success Response (200):**

```json
{
  "success": true,
  "message": "Recent orders retrieved successfully",
  "data": {
    "orders": [
      {
        "code": "251221-6BEPSWK",
        "customer": {
          "name": "John Doe",
          "phone": "+12345678905555555",
          "address": "123 Main St, City, State 1234555sdfasfwer ewrwerwe"
        },
        "totals": {
          "subtotal": 900,
          "discount": 50,
          "final": 850
        },
        "status": "confirmed",
        "createdAt": "2025-12-20T21:13:55.002Z"
      }
    ],
    "count": 2,
    "limit": 10
  }
}
```

**Features:**

- Orders are sorted by creation date (newest first)
- Optional limit parameter with validation (1-100)
- Optimized field selection for performance
- Complete customer and order information

## Inventory Management

The API includes comprehensive inventory management features:

### Automatic Stock Adjustment

1. **Order Creation**: Product quantities are automatically reduced when an order is created
2. **Order Cancellation**: Product quantities are restored when an order is cancelled
3. **Order Updates**:
   - Existing inventory is restored first
   - New inventory requirements are validated
   - Stock is adjusted based on the updated order

### Stock Validation

- Stock availability is checked before allowing orders
- Error messages indicate available vs. requested quantities
- Orders cannot be created or updated if insufficient stock exists

### Soft Delete Behavior

When a product is "deleted" using the DELETE endpoint:

- The product's status is changed to 'deleted'
- The product remains in the database for data integrity
- Deleted products are automatically excluded from:
  - GET `/api/products` (all products)
  - GET `/api/products/:code` (single product)
- This allows for audit trails and potential data recovery

## Deployment Information

### Environment Variables

The API requires the following environment variables:

```
NODE_ENV=development|production
PORT=3000 (or any port of your choice)
DATABASE_URL=mongodb://your-connection-string
```

### Local Development

1. Install dependencies: `npm install`
2. Set up environment variables in `.env` file
3. Start the development server: `npm run dev`
4. The API will be available at `http://localhost:3000/api`

### Production Deployment (Vercel)

The API is configured for serverless deployment on Vercel:

1. Set environment variables in Vercel dashboard
2. Deploy using Vercel CLI or GitHub integration
3. The API will be available at `https://your-app.vercel.app/api`

### Database Connection

The API uses MongoDB with connection pooling:

- Max pool size: 10 connections
- Server selection timeout: 5 seconds
- Socket timeout: 45 seconds
- Connection caching for serverless environments

## Product Code Format

Product codes are automatically generated by the backend and follow this format:

- 4 digits followed by 1 uppercase letter
- Example: `1234A`, `5678B`, `9012C`
- Codes are unique and indexed for efficient queries
- Codes cannot be manually set or changed

## Order Code Format

Order codes are automatically generated with this format:

- Date prefix (6 characters): YYMMDD
- Random suffix (7 characters): Base-36 encoded string
- Example: `231205-K8SJ2F`
- Codes are unique and indexed for efficient queries

## Error Responses

All endpoints may return these common error responses:

### Server Error (500)

```json
{
  "success": false,
  "message": "Server Error",
  "error": "Error message details"
}
```

### Validation Error (400)

```json
{
  "success": false,
  "message": "Validation Error",
  "errors": ["Validation error message 1", "Validation error message 2"]
}
```

### Not Found Error (404)

```json
{
  "success": false,
  "message": "Resource not found"
}
```

## Last Updated

This documentation was last updated on: 2025-12-21
